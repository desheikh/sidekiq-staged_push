#!/usr/bin/env ruby
# frozen_string_literal: true

ENV["BUNDLE_GEMFILE"] ||= File.expand_path("../Gemfile", __dir__)
require "bundler/setup" if File.exist?(ENV["BUNDLE_GEMFILE"])

unless ARGV.any? { |arg| arg == "-r" || arg.start_with?("-r=") || arg.start_with?("--require") }
  ARGV.unshift("-r", File.expand_path("../spec/dummy/config/environment.rb", __dir__))
end

unless ARGV.any? { |arg| arg == "-C" || arg.start_with?("-C=") || arg.start_with?("--config") }
  config_file = File.expand_path("../spec/dummy/config/sidekiq.yml", __dir__)
  ARGV.push("-C", config_file) if File.exist?(config_file)
end

load Gem.bin_path("sidekiq", "sidekiq")
